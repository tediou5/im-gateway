# Link Server Protocol

Author: qians

Date: 2023/4/25

Version: 0.0.1

## LinkProtocol

本协议只用于Link Infra的行为, 与业务逻辑无关. 在原则上, 本协议应该尽可能精简和通用.
并为将来的压缩, 加密等行为留出空间.

### 私聊

| 参数名  | 参数类型           | 说明     | 是否必填 |
| ------- | ------------------ | -------- | -------- |
| recv_id | Vec\<String\>        | 接收者id | 是       |
| content | HexString\<Message\> | 发送内容 | 是       |

- example

    ```json
    [["recvxx"], "a5ba55c5ca5ba5b5a"]
    ```

### 群聊

| 参数名     | 参数类型           | 说明         | 是否必填 |
| ---------- | ------------------ | ------------ | -------- |
| chat_id    | String             | 目的群id     | 是       |
| exclusions | Vec\<String\>      | 排除用户列表 | 是(可空) |
| content    | HexString\<Message\> | 发送内容     | 是       |

- example

    ```json
    ["recvxx", ["exclusion"], "455a4545545a45a"]
    ```

### login

| 参数名    | 参数类型      | 说明           | 是否必填 |
| --------- | ------------- | -------------- | -------- |
| trace_id  | u64           | 追踪id         | 是       |
| base_info | String        | baseInfo       | 是       |
| chats     | Vec\<String\> | 用户所属群列表 | 是       |

- example

    ```json
    [1, "baseinfo jsonstring", ["chat1", "chat2"]]
    ```

### loginFailed

| 参数名   | 参数类型 | 说明     | 是否必填 |
| -------- | -------- | -------- | -------- |
| trace_id | u64      | 追踪id   | 是       |
| reason   | String   | 断开原因 | 是       |

- example

    ```json
    [1, "auth failed"]
    ```

#### 群聊状态更新

| 参数名 | 参数类型                    | 说明 | 是否必填 |
| ------ | --------------------------- | ---- | -------- |
| action | Action(Join, Leave, Notice) | 动作 | 是       |

Join | Leave

| 参数名  | 参数类型      | 说明         | 是否必填 |
| ------- | ------------- | ------------ | -------- |
| chat_id | String        | 目的群id     | 是       |
| users   | Vec\<String\> | 相关用户列表 | 是       |

Notice

| 参数名  | 参数类型           | 说明         | 是否必填 |
| ------- | ------------------ | ------------ | -------- |
| chat_id | String             | 目的群id     | 是       |
| notice  | HexString<Message> | 相关用户列表 | 是       |

- join example

    ```json
    "join": ["cc_1", ["uu1", "uu2"]]
    ```

- leave example

    ```json
    "leave": ["cc_2", ["uu3", "uu4"]]
    ```

- notice example

    ```json
    "notice": ["cc_3", "455a4545545a45a"]
    ```
