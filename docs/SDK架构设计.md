# SDK架构设计

Author: qians

Date: 2023/6/1

Version: v0.0.1

## 分层模块设计

基于模块化分层的设计原则, 对SDK进行拆分, SDK由业务层和基础设施层组成. 对于各层级, 我们要求做到:

- 下层模块至只允许引用同层和下层模块的方法.
- 模块间通过方法访问, 禁止直接使用其他模块内的资源.
- 业务模块应提供拓展性和独立性, 各个业务功能和场景的实现应当减少与其他业务功能或场景的依赖.
- 基础模块应提供稳定性和向上兼容以及业务无关, 基础模块应当提供对基础资源的统一抽象(网络IO, 文件IO, 数据库操作). 并保证对外接口不会因内部迭代而改变.

![分层模块架构](SDK%E5%88%86%E5%B1%82%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)


### 业务层

业务层分为3个模块和2个子层. 其中SDKClinet模块对UI层提供各业务接口, 但调用后会立刻返回, 真正结果通过回调返回前端.
前端转换层再业务监听回调模块中注册监听回调. 当业务处理完成后, 结果就会通过监听回调回转换层.

业务处理层中处理业务逻辑, 承接网络返回的数据, 更新本地缓存, 回调进前端, 更新数据库.

### 基础设施层

基础设施由两部分组成, 数据库和网络. 关于数据库, 这里省略了一个日志模块. 日志模块是对未落盘数据的持久化, 此模块提升了数据库操作的复杂性, 但提高了数据的安全和可靠性, 可选择加入.

关于网络模块, 这是一个高度封闭的模块, 其实现和服务器连接层高度一致, 与业务无关. 核心功能在于对网络流的收发, 消息的加解密, 压缩和解压缩, 报文协议的解析, 数据库的落盘, ACK等.

